<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>„Éê„Éà„É´ÁîªÈù¢</title>
    <link rel="stylesheet" th:href="@{/css/battle.css}">
</head>
<body>
<div class="battle-container">
    <h2>‚öîÔ∏è „Éê„Éà„É´ÈñãÂßãÔºÅ</h2>

    <div class="container">
        <div class="left">
            <div class="status-box enemy">
                <h3 th:text="'EnemyÔºö' + ${enemy.name} + 'ÔºàLv.' + ${enemy.level} + 'Ôºâ'"></h3>
                <p>
                    HPÔºö<span id="enemyHpValue" th:text="${enemy.hp} + '/' + ${enemy.maxHp}"></span>
                    <div class="bar-outer">
                        <div id="enemyHpBar" class="bar-inner hp"></div>
                    </div>
                </p>
                <p th:text="'ATKÔºö' + ${enemy.atk}"></p>
            </div>

            <div class="player-and-skills" style="display: flex; gap: 30px;">
                <div class="status-box player">
                    <h3 th:text="'PlayerÔºö' + ${player.name} + 'ÔºàLv.' + ${player.level} + 'Ôºâ'"></h3>

                    <!-- HP„Ç≤„Éº„Ç∏ -->
                    <p>
                        HPÔºö<span id="hpValue" th:text="${player.hp} + '/' + ${player.maxHp}"></span>
                        <div class="bar-outer">
                            <div id="hpBar" class="bar-inner hp"
                                 th:classappend="${player.hp} < ${player.maxHp} * 0.3 ? ' low-hp' : ''"></div>
                        </div>
                    </p>

                    <!-- MP„Ç≤„Éº„Ç∏ -->
                    <p>
                        MPÔºö<span id="mpValue" th:text="${player.mp} + '/' + ${player.maxMp}"></span>
                        <div class="bar-outer">
                            <div id="mpBar" class="bar-inner mp"></div>
                        </div>
                    </p>

                    <p th:text="'ATKÔºö' + ${player.atk}"></p>
                    <p th:text="'MATKÔºö' + ${player.matk}"></p>
                    <p th:text="'ComboRateÔºö' + ${player.comboRate} + '%'"></p>
                    <p th:text="'CriticalRateÔºö' + ${player.criticalRate} + '%'"></p>
                    <p th:text="'AvoidRateÔºö' + ${player.avoidRate} + '%'"></p>
                    <div class="extra-passive" th:utext="${player.extraPassivesDisplay}"></div>

                    <p>
                        <span th:text="'EXPÔºö' + ${player.exp} + '/' + ${player.expToNextLevel}"></span>
                        <span th:if="${player.lastGainedExp > 0}" class="exp-gain" th:text="' Ôºã' + ${player.lastGainedExp}"></span>
                    </p>
                    <p th:if="${player.lastGainedExp > 0 and player.exp == 0}" class="level-up">üéâ „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ</p>
                    <p th:text="'ÂãùÂà©Êï∞Ôºö' + ${player.wins}"></p>
                </div>

                <!-- „Çπ„Ç≠„É´/ÁµÇ‰∫Ü„Éú„Çø„É≥ -->
                <div>
                    <div class="action-box" th:if="${isFinished == null or !isFinished}">
                        <form th:action="@{/game/attack}" method="post">
                            <h4>üéØ „Çπ„Ç≠„É´</h4>
							<div th:each="skill : ${player.skills}" style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
							    <button class="skill-button" type="submit" name="action"
							            th:value="${skill.name}"
							            th:text="${skill.name + 'ÔºàMP' + skill.mp + 'Ôºâ'}"
							            th:disabled="${player.mp} &lt; ${skill.mp}">
							    </button>
							    <span class="skill-note" th:if="${skill.note}" th:text="' - ' + ${skill.note}"></span>
							</div>
                        </form>

                        <form th:action="@{/game/useItem}" method="post">
                            <button class="item-button" type="submit" th:disabled="${player.usedRecovery}">
                                üíä ÂõûÂæ©„Ç¢„Ç§„ÉÜ„É†‰ΩøÁî®
                            </button>
                        </form>
                    </div>

                    <!-- ÁµÇ‰∫Ü„Éú„Çø„É≥ -->
                    <div class="action-box" th:if="${isFinished}" style="margin-top: 60px;">
                        <form th:action="@{/game/continue}" method="post">
                            <button class="next-button" type="submit" th:if="${player.hp > 0}">‚ñ∂ Ê¨°„ÅÆÊà¶Èóò„Å∏</button>
                        </form>
                        <form th:action="@{/game/end}" method="post" style="margin-top: 30px">
                            <button class="end-button" type="submit">üèÅ ÁµÇ‰∫Ü</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Âè≥Ôºö„É≠„Ç∞ -->
        <div class="right">
            <h3>üìú „Éê„Éà„É´„É≠„Ç∞</h3>
            <div class="log-box" id="logBox">
                <p th:each="line : ${logLines}" th:utext="${line}"></p>
            </div>
        </div>
    </div>
</div>

<!-- JS -->
<script th:src="@{/js/battle.js}"></script>
</body>
</html>